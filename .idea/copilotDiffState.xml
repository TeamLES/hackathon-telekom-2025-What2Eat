<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/api/profile/route.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/api/profile/route.ts" />
              <option name="originalContent" value="import { NextResponse } from &quot;next/server&quot;;&#10;import { createClient } from &quot;@/lib/supabase/server&quot;;&#10;&#10;type ProfilePayload = {&#10;  user_id: string;&#10;  age?: number | null;&#10;  height_cm?: number | null;&#10;  weight_kg?: number | null;&#10;  calorie_target?: number | null;&#10;  activity_level?: string | null;&#10;  primary_goal?: string | null;&#10;  meals_per_day?: number | null;&#10;  cooking_skill?: string | null;&#10;  updated_at?: string;&#10;};&#10;&#10;export async function POST(req: Request) {&#10;  const supabase = await createClient();&#10;  const { data: { user } } = await supabase.auth.getUser();&#10;&#10;  if (!user) {&#10;    return NextResponse.json({ error: &quot;Not authenticated&quot; }, { status: 401 });&#10;  }&#10;&#10;  const body = await req.json();&#10;&#10;  const payload: ProfilePayload = {&#10;    user_id: user.id,&#10;    age: body.age ?? null,&#10;    height_cm: body.height_cm ?? null,&#10;    weight_kg: body.weight_kg ?? null,&#10;    calorie_target: body.calorie_target ?? null,&#10;    activity_level: body.activity_level ?? null,&#10;    primary_goal: body.primary_goal ?? null,&#10;    meals_per_day: body.meals_per_day ?? null,&#10;    cooking_skill: body.cooking_skill ?? null,&#10;    updated_at: new Date().toISOString(),&#10;  };&#10;&#10;  const { data, error } = await supabase&#10;    .from(&quot;nutrition_profiles&quot;)&#10;    .upsert(payload, { onConflict: &quot;user_id&quot; })&#10;    .select()&#10;    .single();&#10;&#10;  if (error) {&#10;    return NextResponse.json({ error: error.message }, { status: 500 });&#10;  }&#10;&#10;  return NextResponse.json({ profile: data });&#10;}&#10;" />
              <option name="updatedContent" value="import { NextResponse } from &quot;next/server&quot;;&#10;import { createClient } from &quot;@/lib/supabase/server&quot;;&#10;&#10;type ProfilePayload = {&#10;  // profiles&#10;  full_name?: string | null;&#10;  username?: string | null;&#10;&#10;  // nutrition_profiles&#10;  gender?: string | null;&#10;  age?: number | null;&#10;  height_cm?: number | null;&#10;  weight_kg?: number | null;&#10;  activity_level?: string | null;&#10;  is_morning_person?: boolean | null;&#10;  usually_rushed_mornings?: boolean | null;&#10;  primary_goal?: string | null;&#10;  calorie_target?: number | null;&#10;  protein_target_g?: number | null;&#10;  meals_per_day?: number | null;&#10;  budget_level?: string | null;&#10;  cooking_skill?: string | null;&#10;  snacks_included?: boolean | null;&#10;  snacks_often?: boolean | null;&#10;&#10;  // relations (arrays of ids)&#10;  favorite_cuisines?: number[] | null;&#10;  dietary_restrictions?: number[] | null;&#10;  kitchen_equipment?: number[] | null;&#10;&#10;  // preferences&#10;  ai_tone?: string | null;&#10;  focus_priorities?: string[] | null;&#10;};&#10;&#10;export async function POST(req: Request) {&#10;  const supabase = await createClient();&#10;  const { data: { user } } = await supabase.auth.getUser();&#10;&#10;  if (!user) {&#10;    return NextResponse.json({ error: &quot;Not authenticated&quot; }, { status: 401 });&#10;  }&#10;&#10;  const body: ProfilePayload = await req.json();&#10;&#10;  try {&#10;    // 0) Update profiles table (full_name / username)&#10;    if (body.full_name !== undefined || body.username !== undefined) {&#10;      const update: any = {};&#10;      if (body.full_name !== undefined) update.full_name = body.full_name;&#10;      if (body.username !== undefined) update.username = body.username;&#10;&#10;      const { error: pError } = await supabase&#10;        .from(&quot;profiles&quot;)&#10;        .update(update)&#10;        .eq(&quot;id&quot;, user.id);&#10;&#10;      if (pError) throw pError;&#10;    }&#10;&#10;    // 1) Upsert nutrition_profiles&#10;    const npayload: any = {&#10;      user_id: user.id,&#10;      gender: body.gender ?? null,&#10;      age: body.age ?? null,&#10;      height_cm: body.height_cm ?? null,&#10;      weight_kg: body.weight_kg ?? null,&#10;      activity_level: body.activity_level ?? null,&#10;      is_morning_person: body.is_morning_person ?? null,&#10;      usually_rushed_mornings: body.usually_rushed_mornings ?? null,&#10;      primary_goal: body.primary_goal ?? null,&#10;      calorie_target: body.calorie_target ?? null,&#10;      protein_target_g: body.protein_target_g ?? null,&#10;      meals_per_day: body.meals_per_day ?? null,&#10;      budget_level: body.budget_level ?? null,&#10;      cooking_skill: body.cooking_skill ?? null,&#10;      snacks_included: body.snacks_included ?? null,&#10;      snacks_often: body.snacks_often ?? null,&#10;      updated_at: new Date().toISOString(),&#10;    };&#10;&#10;    const { data: npData, error: npError } = await supabase&#10;      .from(&quot;nutrition_profiles&quot;)&#10;      .upsert(npayload, { onConflict: &quot;user_id&quot; })&#10;      .select()&#10;      .single();&#10;&#10;    if (npError) throw npError;&#10;&#10;    // 2) Relations: favorite_cuisines, dietary_restrictions, kitchen_equipment&#10;    if (Array.isArray(body.favorite_cuisines)) {&#10;      await supabase.from(&quot;user_favorite_cuisines&quot;).delete().eq(&quot;user_id&quot;, user.id);&#10;      if (body.favorite_cuisines.length &gt; 0) {&#10;        const rows = body.favorite_cuisines.map((c) =&gt; ({ user_id: user.id, cuisine_id: c }));&#10;        const { error: fcError } = await supabase.from(&quot;user_favorite_cuisines&quot;).insert(rows);&#10;        if (fcError) throw fcError;&#10;      }&#10;    }&#10;&#10;    if (Array.isArray(body.dietary_restrictions)) {&#10;      await supabase.from(&quot;user_dietary_restrictions&quot;).delete().eq(&quot;user_id&quot;, user.id);&#10;      if (body.dietary_restrictions.length &gt; 0) {&#10;        const rows = body.dietary_restrictions.map((r) =&gt; ({ user_id: user.id, restriction_id: r }));&#10;        const { error: drError } = await supabase.from(&quot;user_dietary_restrictions&quot;).insert(rows);&#10;        if (drError) throw drError;&#10;      }&#10;    }&#10;&#10;    if (Array.isArray(body.kitchen_equipment)) {&#10;      await supabase.from(&quot;user_kitchen_equipment&quot;).delete().eq(&quot;user_id&quot;, user.id);&#10;      if (body.kitchen_equipment.length &gt; 0) {&#10;        const rows = body.kitchen_equipment.map((e) =&gt; ({ user_id: user.id, equipment_id: e }));&#10;        const { error: keError } = await supabase.from(&quot;user_kitchen_equipment&quot;).insert(rows);&#10;        if (keError) throw keError;&#10;      }&#10;    }&#10;&#10;    // 3) user_preferences&#10;    if (body.ai_tone !== undefined || Array.isArray(body.focus_priorities)) {&#10;      const upayload: any = { user_id: user.id };&#10;      if (body.ai_tone !== undefined) upayload.ai_tone = body.ai_tone ?? null;&#10;      if (Array.isArray(body.focus_priorities)) upayload.focus_priorities = body.focus_priorities.length &gt; 0 ? body.focus_priorities : null;&#10;&#10;      const { error: upError } = await supabase.from(&quot;user_preferences&quot;).upsert(upayload);&#10;      if (upError) throw upError;&#10;    }&#10;&#10;    return NextResponse.json({ profile: npData });&#10;  } catch (error: any) {&#10;    console.error(&quot;Error updating profile:&quot;, error);&#10;    return NextResponse.json({ error: error.message || String(error) }, { status: 500 });&#10;  }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/components/profile-edit-button.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/components/profile-edit-button.tsx" />
              <option name="originalContent" value="&quot;use client&quot;;&#10;&#10;import React from &quot;react&quot;;&#10;import { Button } from &quot;@/components/ui/button&quot;;&#10;&#10;export default function ProfileEditButton({ label = &quot;Edit&quot; }: { label?: string }) {&#10;  function openEditor() {&#10;    if (typeof window !== &quot;undefined&quot;) {&#10;      window.dispatchEvent(new CustomEvent(&quot;profile-open-edit&quot;));&#10;    }&#10;  }&#10;&#10;  return (&#10;    &lt;Button onClick={openEditor}  className=&quot;ml-2&quot;&gt;&#10;      {label}&#10;    &lt;/Button&gt;&#10;  );&#10;}&#10;&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;&#10;import React from &quot;react&quot;;&#10;import { Button } from &quot;@/components/ui/button&quot;;&#10;&#10;export default function ProfileEditButton({ label = &quot;Edit&quot; }: { label?: string }) {&#10;  function openEditor() {&#10;    if (typeof window !== &quot;undefined&quot;) {&#10;      window.dispatchEvent(new CustomEvent(&quot;profile-open-edit&quot;));&#10;    }&#10;  }&#10;&#10;  return (&#10;    // use a more visible button variant so users notice it&#10;    &lt;Button onClick={openEditor} className=&quot;ml-2&quot; aria-label=&quot;Edit nutrition profile&quot;&gt;&#10;      {label}&#10;    &lt;/Button&gt;&#10;  );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/components/profile-form.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/components/profile-form.tsx" />
              <option name="originalContent" value="&quot;use client&quot;;&#10;&#10;import React, { useState, useEffect } from &quot;react&quot;;&#10;import { useRouter } from &quot;next/navigation&quot;;&#10;import { Input } from &quot;@/components/ui/input&quot;;&#10;import { Label } from &quot;@/components/ui/label&quot;;&#10;import { Button } from &quot;@/components/ui/button&quot;;&#10;import { Select, SelectTrigger, SelectContent, SelectItem, SelectValue } from &quot;@/components/ui/select&quot;;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;;&#10;import { CardHeader, CardTitle } from &quot;@/components/ui/card&quot;;&#10;import { createClient } from &quot;@/lib/supabase/client&quot;;&#10;&#10;type Profile = {&#10;  id?: string | number;&#10;  user_id?: string;&#10;  full_name?: string | null;&#10;  username?: string | null;&#10;  age?: number | null;&#10;  weight_kg?: number | null;&#10;  height_cm?: number | null;&#10;  calorie_target?: number | null;&#10;  activity_level?: string | null;&#10;  primary_goal?: string | null;&#10;  meals_per_day?: number | null;&#10;  cooking_skill?: string | null;&#10;  gender?: string | null;&#10;  budget_level?: string | null;&#10;  is_morning_person?: boolean | null;&#10;  usually_rushed_mornings?: boolean | null;&#10;  snacks_included?: boolean | null;&#10;  snacks_often?: boolean | null;&#10;  protein_target_g?: number | null;&#10;  favorite_cuisines?: number[] | null;&#10;  dietary_restrictions?: number[] | null;&#10;  kitchen_equipment?: number[] | null;&#10;  ai_tone?: string | null;&#10;  focus_priorities?: string[] | null;&#10;};&#10;&#10;export default function ProfileForm({ initialProfile, showHeader = true }: { initialProfile: Profile | null; showHeader?: boolean }) {&#10;  const router = useRouter();&#10;  const [editing, setEditing] = useState(false);&#10;  const [loading, setLoading] = useState(false);&#10;  const [form, setForm] = useState&lt;Profile&gt;({&#10;    full_name: &quot;&quot;,&#10;    username: &quot;&quot;,&#10;    gender: initialProfile?.gender ?? &quot;&quot;,&#10;    age: initialProfile?.age ?? null,&#10;    weight_kg: initialProfile?.weight_kg ?? null,&#10;    height_cm: initialProfile?.height_cm ?? null,&#10;    calorie_target: initialProfile?.calorie_target ?? null,&#10;    protein_target_g: initialProfile?.protein_target_g ?? null,&#10;    activity_level: initialProfile?.activity_level ?? &quot;&quot;,&#10;    primary_goal: initialProfile?.primary_goal ?? &quot;&quot;,&#10;    meals_per_day: initialProfile?.meals_per_day ?? null,&#10;    budget_level: initialProfile?.budget_level ?? &quot;&quot;,&#10;    cooking_skill: initialProfile?.cooking_skill ?? &quot;&quot;,&#10;    is_morning_person: initialProfile?.is_morning_person ?? false,&#10;    usually_rushed_mornings: initialProfile?.usually_rushed_mornings ?? false,&#10;    snacks_included: initialProfile?.snacks_included ?? false,&#10;    snacks_often: initialProfile?.snacks_often ?? false,&#10;    favorite_cuisines: [],&#10;    dietary_restrictions: [],&#10;    kitchen_equipment: [],&#10;    ai_tone: &quot;&quot;,&#10;    focus_priorities: [],&#10;  });&#10;  const [error, setError] = useState&lt;string | null&gt;(null);&#10;&#10;  const [cuisines, setCuisines] = useState&lt;{ id: number; name: string }[]&gt;([]);&#10;  const [dietaryOptions, setDietaryOptions] = useState&lt;{ id: number; label: string }[]&gt;([]);&#10;  const [equipmentOptions, setEquipmentOptions] = useState&lt;{ id: number; label: string }[]&gt;([]);&#10;&#10;  const supabase = createClient();&#10;&#10;  useEffect(() =&gt; {&#10;    async function loadLookups() {&#10;      try {&#10;        const [cRes, dRes, eRes] = await Promise.all([&#10;          supabase.from(&quot;cuisines&quot;).select(&quot;id,name&quot;).order(&quot;name&quot;),&#10;          supabase.from(&quot;dietary_restrictions&quot;).select(&quot;id,label&quot;).order(&quot;label&quot;),&#10;          supabase.from(&quot;kitchen_equipment&quot;).select(&quot;id,label&quot;).order(&quot;label&quot;),&#10;        ]);&#10;&#10;        if (cRes.data) setCuisines(cRes.data as { id: number; name: string }[]);&#10;        if (dRes.data) setDietaryOptions(dRes.data as { id: number; label: string }[]);&#10;        if (eRes.data) setEquipmentOptions(eRes.data as { id: number; label: string }[]);&#10;      } catch (err) {&#10;        console.error(&quot;Error loading lookups:&quot;, err);&#10;      }&#10;    }&#10;&#10;    loadLookups();&#10;  }, [supabase]);&#10;&#10;  // load user's related rows &amp; profile (full_name/username/preferences)&#10;  useEffect(() =&gt; {&#10;    async function loadUserData() {&#10;      try {&#10;        const { data: authData } = await supabase.auth.getUser();&#10;        const userId = authData?.user?.id;&#10;        if (!userId) return;&#10;&#10;        const [{ data: profileRow }, { data: favCuisines }, { data: dietRestr }, { data: equip }, { data: prefs }] = await Promise.all([&#10;          supabase.from(&quot;profiles&quot;).select(&quot;full_name,username&quot;).eq(&quot;id&quot;, userId).single(),&#10;          supabase.from(&quot;user_favorite_cuisines&quot;).select(&quot;cuisine_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_dietary_restrictions&quot;).select(&quot;restriction_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_kitchen_equipment&quot;).select(&quot;equipment_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_preferences&quot;).select(&quot;ai_tone,focus_priorities&quot;).eq(&quot;user_id&quot;, userId).single(),&#10;        ]);&#10;&#10;        if (profileRow?.full_name || profileRow?.username) setForm((s) =&gt; ({ ...s, full_name: profileRow.full_name ?? s.full_name, username: profileRow.username ?? s.username }));&#10;&#10;        if (Array.isArray(favCuisines)) setForm((s) =&gt; ({ ...s, favorite_cuisines: favCuisines.map((r: { cuisine_id: number }) =&gt; r.cuisine_id) }));&#10;        if (Array.isArray(dietRestr)) setForm((s) =&gt; ({ ...s, dietary_restrictions: dietRestr.map((r: { restriction_id: number }) =&gt; r.restriction_id) }));&#10;        if (Array.isArray(equip)) setForm((s) =&gt; ({ ...s, kitchen_equipment: equip.map((r: { equipment_id: number }) =&gt; r.equipment_id) }));&#10;        if (prefs) setForm((s) =&gt; ({ ...s, ai_tone: prefs.ai_tone ?? s.ai_tone, focus_priorities: prefs.focus_priorities ?? s.focus_priorities }));&#10;      } catch (err) {&#10;        // ignore missing rows&#10;        console.error(&quot;loadUserData error:&quot;, err);&#10;      }&#10;    }&#10;&#10;    loadUserData();&#10;    // eslint-disable-next-line react-hooks/exhaustive-deps&#10;  }, []);&#10;&#10;  function updateField&lt;K extends keyof Profile&gt;(key: K, value: Profile[K]) {&#10;    setForm((s) =&gt; ({ ...s, [key]: value }));&#10;  }&#10;&#10;  async function save(e?: React.FormEvent) {&#10;    e?.preventDefault();&#10;    setLoading(true);&#10;    setError(null);&#10;&#10;    try {&#10;      const res = await fetch(&quot;/api/profile&quot;, {&#10;        method: &quot;POST&quot;,&#10;        headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },&#10;        body: JSON.stringify({ ...form }),&#10;      });&#10;&#10;      const json = await res.json();&#10;      if (!res.ok) {&#10;        setError(json?.error || &quot;Failed to save profile&quot;);&#10;      } else {&#10;        setEditing(false);&#10;        // refresh server data&#10;        router.refresh();&#10;      }&#10;    } catch (err: unknown) {&#10;      if (err instanceof Error) setError(err.message);&#10;      else setError(String(err));&#10;    } finally {&#10;      setLoading(false);&#10;    }&#10;  }&#10;&#10;  useEffect(() =&gt; {&#10;    function openEditor() {&#10;      setEditing(true);&#10;    }&#10;    if (typeof window !== &quot;undefined&quot;) {&#10;      window.addEventListener(&quot;profile-open-edit&quot;, openEditor as EventListener);&#10;    }&#10;    return () =&gt; {&#10;      if (typeof window !== &quot;undefined&quot;) {&#10;        window.removeEventListener(&quot;profile-open-edit&quot;, openEditor as EventListener);&#10;      }&#10;    };&#10;  }, []);&#10;&#10;  if (!initialProfile) {&#10;    return (&#10;      &lt;div&gt;&#10;        &lt;div className=&quot;flex items-center justify-between mb-2&quot;&gt;&#10;          {showHeader &amp;&amp; (&#10;            &lt;div&gt;&#10;              &lt;h3 className=&quot;text-lg font-medium&quot;&gt;Nutrition Profile&lt;/h3&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;You have not set up a nutrition profile yet.&lt;/p&gt;&#10;            &lt;/div&gt;&#10;          )}&#10;          {editing &amp;&amp; (&#10;            &lt;form onSubmit={save} className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-4&quot;&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Full name&lt;/Label&gt;&#10;                &lt;Input value={form.full_name ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;full_name&quot;, e.target.value)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Username&lt;/Label&gt;&#10;                &lt;Input value={form.username ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;username&quot;, e.target.value)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Age&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.age ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;age&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Weight (kg)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.weight_kg ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;weight_kg&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Height (cm)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.height_cm ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;height_cm&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Calorie Target (kcal)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.calorie_target ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;calorie_target&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Activity Level&lt;/Label&gt;&#10;                &lt;Select value={String(form.activity_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;activity_level&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;sedentary&quot;&gt;Sedentary&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;lightly_active&quot;&gt;Lightly active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;moderately_active&quot;&gt;Moderately active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;very_active&quot;&gt;Very active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;athlete&quot;&gt;Athlete&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Gender&lt;/Label&gt;&#10;                &lt;Select value={String(form.gender ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;gender&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;male&quot;&gt;Male&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;female&quot;&gt;Female&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;other&quot;&gt;Other&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;prefer_not_to_say&quot;&gt;Prefer not to say&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Goal&lt;/Label&gt;&#10;                &lt;Select value={String(form.primary_goal ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;primary_goal&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;maintain_weight&quot;&gt;Maintain weight&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;lose_weight&quot;&gt;Lose weight&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;gain_weight&quot;&gt;Gain weight&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Meals per day&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.meals_per_day ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;meals_per_day&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Cooking skill&lt;/Label&gt;&#10;                &lt;Select value={String(form.cooking_skill ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;cooking_skill&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;beginner&quot;&gt;Beginner&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;intermediate&quot;&gt;Intermediate&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;advanced&quot;&gt;Advanced&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;&#10;              {/* Extended onboarding fields -&gt; ensure they are available in edit mode too */}&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Budget level&lt;/Label&gt;&#10;                &lt;Select value={String(form.budget_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;budget_level&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;low&quot;&gt;Low&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;medium&quot;&gt;Medium&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;high&quot;&gt;High&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;no_preference&quot;&gt;No preference&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Protein target (g)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.protein_target_g ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;protein_target_g&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Is morning person&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.is_morning_person} onCheckedChange={(v) =&gt; updateField(&quot;is_morning_person&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Usually rushed mornings&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.usually_rushed_mornings} onCheckedChange={(v) =&gt; updateField(&quot;usually_rushed_mornings&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Include snacks&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.snacks_included} onCheckedChange={(v) =&gt; updateField(&quot;snacks_included&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Snack often&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.snacks_often} onCheckedChange={(v) =&gt; updateField(&quot;snacks_often&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Favorite cuisines&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {cuisines.map((c) =&gt; (&#10;                    &lt;label key={c.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.favorite_cuisines?.includes(c.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.favorite_cuisines?.includes(c.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.favorite_cuisines ?? [];&#10;                        const updated = current.includes(c.id) ? current.filter((i) =&gt; i !== c.id) : [...current, c.id];&#10;                        updateField(&quot;favorite_cuisines&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{c.name}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Dietary restrictions&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {dietaryOptions.map((d) =&gt; (&#10;                    &lt;label key={d.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.dietary_restrictions?.includes(d.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.dietary_restrictions?.includes(d.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.dietary_restrictions ?? [];&#10;                        const updated = current.includes(d.id) ? current.filter((i) =&gt; i !== d.id) : [...current, d.id];&#10;                        updateField(&quot;dietary_restrictions&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{d.label}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Kitchen equipment&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {equipmentOptions.map((e) =&gt; (&#10;                    &lt;label key={e.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.kitchen_equipment?.includes(e.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.kitchen_equipment?.includes(e.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.kitchen_equipment ?? [];&#10;                        const updated = current.includes(e.id) ? current.filter((i) =&gt; i !== e.id) : [...current, e.id];&#10;                        updateField(&quot;kitchen_equipment&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{e.label}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;              &lt;div className=&quot;col-span-full flex gap-2 justify-end&quot;&gt;&#10;                &lt;Button variant=&quot;secondary&quot; onClick={() =&gt; setEditing(false)} type=&quot;button&quot;&gt;Cancel&lt;/Button&gt;&#10;                &lt;Button type=&quot;submit&quot; disabled={loading}&gt;{loading ? &quot;Saving...&quot; : &quot;Save&quot;}&lt;/Button&gt;&#10;              &lt;/div&gt;&#10;              {error &amp;&amp; &lt;p className=&quot;text-sm text-destructive col-span-full&quot;&gt;{error}&lt;/p&gt;}&#10;            &lt;/form&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  }&#10;&#10;  return (&#10;    &lt;div&gt;&#10;      &lt;div className=&quot;flex items-center justify-between mb-2&quot;&gt;&#10;        {showHeader &amp;&amp; (&#10;          &lt;div&gt;&#10;            &lt;h3 className=&quot;text-lg font-medium&quot;&gt;Nutrition Profile&lt;/h3&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Your dietary settings&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        )}&#10;&#10;      &lt;/div&gt;&#10;&#10;      {!editing ? (&#10;        &lt;div className=&quot;grid grid-cols-2 md:grid-cols-4 gap-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Age&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.age ?? &quot;—&quot;} years&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Weight&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.weight_kg ?? &quot;—&quot;} kg&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Height&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.height_cm ?? &quot;—&quot;} cm&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Calorie Target&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.calorie_target ?? &quot;—&quot;} kcal&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Activity Level&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{String(initialProfile.activity_level ?? &quot;&quot;).replace(&quot;_&quot;, &quot; &quot;) || &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Goal&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{String(initialProfile.primary_goal ?? &quot;&quot;).replace(&quot;_&quot;, &quot; &quot;) || &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Meals per Day&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.meals_per_day ?? &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Cooking Skill&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{initialProfile.cooking_skill ?? &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      ) : (&#10;        &lt;form onSubmit={save} className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Full name&lt;/Label&gt;&#10;            &lt;Input value={form.full_name ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;full_name&quot;, e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Username&lt;/Label&gt;&#10;            &lt;Input value={form.username ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;username&quot;, e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Age&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.age ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;age&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Weight (kg)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.weight_kg ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;weight_kg&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Height (cm)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.height_cm ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;height_cm&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Calorie Target (kcal)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.calorie_target ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;calorie_target&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Activity Level&lt;/Label&gt;&#10;            &lt;Select value={String(form.activity_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;activity_level&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;sedentary&quot;&gt;Sedentary&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;lightly_active&quot;&gt;Lightly active&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;moderately_active&quot;&gt;Moderately active&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;very_active&quot;&gt;Very active&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Goal&lt;/Label&gt;&#10;            &lt;Select value={String(form.primary_goal ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;primary_goal&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;maintain_weight&quot;&gt;Maintain weight&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;lose_weight&quot;&gt;Lose weight&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;gain_weight&quot;&gt;Gain weight&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Meals per day&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.meals_per_day ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;meals_per_day&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Cooking skill&lt;/Label&gt;&#10;            &lt;Select value={String(form.cooking_skill ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;cooking_skill&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;beginner&quot;&gt;Beginner&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;intermediate&quot;&gt;Intermediate&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;advanced&quot;&gt;Advanced&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div className=&quot;col-span-full flex gap-2 justify-end&quot;&gt;&#10;            &lt;Button variant=&quot;secondary&quot; onClick={() =&gt; setEditing(false)} type=&quot;button&quot;&gt;Cancel&lt;/Button&gt;&#10;            &lt;Button type=&quot;submit&quot; disabled={loading}&gt;{loading ? &quot;Saving...&quot; : &quot;Save&quot;}&lt;/Button&gt;&#10;          &lt;/div&gt;&#10;          {error &amp;&amp; &lt;p className=&quot;text-sm text-destructive col-span-full&quot;&gt;{error}&lt;/p&gt;}&#10;        &lt;/form&gt;&#10;      )}&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;&#10;import React, { useState, useEffect } from &quot;react&quot;;&#10;import { useRouter } from &quot;next/navigation&quot;;&#10;import { Input } from &quot;@/components/ui/input&quot;;&#10;import { Label } from &quot;@/components/ui/label&quot;;&#10;import { Button } from &quot;@/components/ui/button&quot;;&#10;import { Select, SelectTrigger, SelectContent, SelectItem, SelectValue } from &quot;@/components/ui/select&quot;;&#10;import { Checkbox } from &quot;@/components/ui/checkbox&quot;;&#10;import { CardHeader, CardTitle } from &quot;@/components/ui/card&quot;;&#10;import { createClient } from &quot;@/lib/supabase/client&quot;;&#10;&#10;type Profile = {&#10;  id?: string | number;&#10;  user_id?: string;&#10;  full_name?: string | null;&#10;  username?: string | null;&#10;  age?: number | null;&#10;  weight_kg?: number | null;&#10;  height_cm?: number | null;&#10;  calorie_target?: number | null;&#10;  activity_level?: string | null;&#10;  primary_goal?: string | null;&#10;  meals_per_day?: number | null;&#10;  cooking_skill?: string | null;&#10;  gender?: string | null;&#10;  budget_level?: string | null;&#10;  is_morning_person?: boolean | null;&#10;  usually_rushed_mornings?: boolean | null;&#10;  snacks_included?: boolean | null;&#10;  snacks_often?: boolean | null;&#10;  protein_target_g?: number | null;&#10;  favorite_cuisines?: number[] | null;&#10;  dietary_restrictions?: number[] | null;&#10;  kitchen_equipment?: number[] | null;&#10;  ai_tone?: string | null;&#10;  focus_priorities?: string[] | null;&#10;};&#10;&#10;export default function ProfileForm({ initialProfile, showHeader = true }: { initialProfile: Profile | null; showHeader?: boolean }) {&#10;  const router = useRouter();&#10;  const [editing, setEditing] = useState(false);&#10;  const [loading, setLoading] = useState(false);&#10;  const [form, setForm] = useState&lt;Profile&gt;({&#10;    full_name: &quot;&quot;,&#10;    username: &quot;&quot;,&#10;    gender: initialProfile?.gender ?? &quot;&quot;,&#10;    age: initialProfile?.age ?? null,&#10;    weight_kg: initialProfile?.weight_kg ?? null,&#10;    height_cm: initialProfile?.height_cm ?? null,&#10;    calorie_target: initialProfile?.calorie_target ?? null,&#10;    protein_target_g: initialProfile?.protein_target_g ?? null,&#10;    activity_level: initialProfile?.activity_level ?? &quot;&quot;,&#10;    primary_goal: initialProfile?.primary_goal ?? &quot;&quot;,&#10;    meals_per_day: initialProfile?.meals_per_day ?? null,&#10;    budget_level: initialProfile?.budget_level ?? &quot;&quot;,&#10;    cooking_skill: initialProfile?.cooking_skill ?? &quot;&quot;,&#10;    is_morning_person: initialProfile?.is_morning_person ?? false,&#10;    usually_rushed_mornings: initialProfile?.usually_rushed_mornings ?? false,&#10;    snacks_included: initialProfile?.snacks_included ?? false,&#10;    snacks_often: initialProfile?.snacks_often ?? false,&#10;    favorite_cuisines: [],&#10;    dietary_restrictions: [],&#10;    kitchen_equipment: [],&#10;    ai_tone: &quot;&quot;,&#10;    focus_priorities: [],&#10;  });&#10;  const [error, setError] = useState&lt;string | null&gt;(null);&#10;&#10;  const [cuisines, setCuisines] = useState&lt;{ id: number; name: string }[]&gt;([]);&#10;  const [dietaryOptions, setDietaryOptions] = useState&lt;{ id: number; label: string }[]&gt;([]);&#10;  const [equipmentOptions, setEquipmentOptions] = useState&lt;{ id: number; label: string }[]&gt;([]);&#10;&#10;  const supabase = createClient();&#10;&#10;  useEffect(() =&gt; {&#10;    async function loadLookups() {&#10;      try {&#10;        const [cRes, dRes, eRes] = await Promise.all([&#10;          supabase.from(&quot;cuisines&quot;).select(&quot;id,name&quot;).order(&quot;name&quot;),&#10;          supabase.from(&quot;dietary_restrictions&quot;).select(&quot;id,label&quot;).order(&quot;label&quot;),&#10;          supabase.from(&quot;kitchen_equipment&quot;).select(&quot;id,label&quot;).order(&quot;label&quot;),&#10;        ]);&#10;&#10;        if (cRes.data) setCuisines(cRes.data as { id: number; name: string }[]);&#10;        if (dRes.data) setDietaryOptions(dRes.data as { id: number; label: string }[]);&#10;        if (eRes.data) setEquipmentOptions(eRes.data as { id: number; label: string }[]);&#10;      } catch (err) {&#10;        console.error(&quot;Error loading lookups:&quot;, err);&#10;      }&#10;    }&#10;&#10;    loadLookups();&#10;  }, [supabase]);&#10;&#10;  // load user's related rows &amp; profile (full_name/username/preferences)&#10;  useEffect(() =&gt; {&#10;    async function loadUserData() {&#10;      try {&#10;        const { data: authData } = await supabase.auth.getUser();&#10;        const userId = authData?.user?.id;&#10;        if (!userId) return;&#10;&#10;        const [{ data: profileRow }, { data: favCuisines }, { data: dietRestr }, { data: equip }, { data: prefs }] = await Promise.all([&#10;          supabase.from(&quot;profiles&quot;).select(&quot;full_name,username&quot;).eq(&quot;id&quot;, userId).single(),&#10;          supabase.from(&quot;user_favorite_cuisines&quot;).select(&quot;cuisine_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_dietary_restrictions&quot;).select(&quot;restriction_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_kitchen_equipment&quot;).select(&quot;equipment_id&quot;).eq(&quot;user_id&quot;, userId),&#10;          supabase.from(&quot;user_preferences&quot;).select(&quot;ai_tone,focus_priorities&quot;).eq(&quot;user_id&quot;, userId).single(),&#10;        ]);&#10;&#10;        if (profileRow?.full_name || profileRow?.username) setForm((s) =&gt; ({ ...s, full_name: profileRow.full_name ?? s.full_name, username: profileRow.username ?? s.username }));&#10;&#10;        if (Array.isArray(favCuisines)) setForm((s) =&gt; ({ ...s, favorite_cuisines: favCuisines.map((r: { cuisine_id: number }) =&gt; r.cuisine_id) }));&#10;        if (Array.isArray(dietRestr)) setForm((s) =&gt; ({ ...s, dietary_restrictions: dietRestr.map((r: { restriction_id: number }) =&gt; r.restriction_id) }));&#10;        if (Array.isArray(equip)) setForm((s) =&gt; ({ ...s, kitchen_equipment: equip.map((r: { equipment_id: number }) =&gt; r.equipment_id) }));&#10;        if (prefs) setForm((s) =&gt; ({ ...s, ai_tone: prefs.ai_tone ?? s.ai_tone, focus_priorities: prefs.focus_priorities ?? s.focus_priorities }));&#10;      } catch (err) {&#10;        // ignore missing rows&#10;        console.error(&quot;loadUserData error:&quot;, err);&#10;      }&#10;    }&#10;&#10;    loadUserData();&#10;    // eslint-disable-next-line react-hooks/exhaustive-deps&#10;  }, []);&#10;&#10;  function updateField&lt;K extends keyof Profile&gt;(key: K, value: Profile[K]) {&#10;    setForm((s) =&gt; ({ ...s, [key]: value }));&#10;  }&#10;&#10;  async function save(e?: React.FormEvent) {&#10;    e?.preventDefault();&#10;    setLoading(true);&#10;    setError(null);&#10;&#10;    try {&#10;      const res = await fetch(&quot;/api/profile&quot;, {&#10;        method: &quot;POST&quot;,&#10;        headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },&#10;        body: JSON.stringify({ ...form }),&#10;      });&#10;&#10;      const json = await res.json();&#10;      if (!res.ok) {&#10;        setError(json?.error || &quot;Failed to save profile&quot;);&#10;      } else {&#10;        setEditing(false);&#10;        // refresh server data&#10;        router.refresh();&#10;      }&#10;    } catch (err: unknown) {&#10;      if (err instanceof Error) setError(err.message);&#10;      else setError(String(err));&#10;    } finally {&#10;      setLoading(false);&#10;    }&#10;  }&#10;&#10;  useEffect(() =&gt; {&#10;    function openEditor() {&#10;      setEditing(true);&#10;    }&#10;    if (typeof window !== &quot;undefined&quot;) {&#10;      window.addEventListener(&quot;profile-open-edit&quot;, openEditor as EventListener);&#10;    }&#10;    return () =&gt; {&#10;      if (typeof window !== &quot;undefined&quot;) {&#10;        window.removeEventListener(&quot;profile-open-edit&quot;, openEditor as EventListener);&#10;      }&#10;    };&#10;  }, []);&#10;&#10;  if (!initialProfile) {&#10;    return (&#10;      &lt;div&gt;&#10;        &lt;div className=&quot;flex items-center justify-between mb-2&quot;&gt;&#10;          {showHeader &amp;&amp; (&#10;            &lt;div&gt;&#10;              &lt;h3 className=&quot;text-lg font-medium&quot;&gt;Nutrition Profile&lt;/h3&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;You have not set up a nutrition profile yet.&lt;/p&gt;&#10;            &lt;/div&gt;&#10;          )}&#10;          {editing &amp;&amp; (&#10;            &lt;form onSubmit={save} className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-4&quot;&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Full name&lt;/Label&gt;&#10;                &lt;Input value={form.full_name ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;full_name&quot;, e.target.value)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Username&lt;/Label&gt;&#10;                &lt;Input value={form.username ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;username&quot;, e.target.value)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Age&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.age ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;age&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Weight (kg)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.weight_kg ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;weight_kg&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Height (cm)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.height_cm ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;height_cm&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Calorie Target (kcal)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.calorie_target ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;calorie_target&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Activity Level&lt;/Label&gt;&#10;                &lt;Select value={String(form.activity_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;activity_level&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;sedentary&quot;&gt;Sedentary&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;lightly_active&quot;&gt;Lightly active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;moderately_active&quot;&gt;Moderately active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;very_active&quot;&gt;Very active&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;athlete&quot;&gt;Athlete&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Gender&lt;/Label&gt;&#10;                &lt;Select value={String(form.gender ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;gender&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;male&quot;&gt;Male&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;female&quot;&gt;Female&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;other&quot;&gt;Other&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;prefer_not_to_say&quot;&gt;Prefer not to say&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Goal&lt;/Label&gt;&#10;                &lt;Select value={String(form.primary_goal ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;primary_goal&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;maintain_weight&quot;&gt;Maintain weight&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;lose_weight&quot;&gt;Lose weight&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;gain_weight&quot;&gt;Gain weight&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Meals per day&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.meals_per_day ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;meals_per_day&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Cooking skill&lt;/Label&gt;&#10;                &lt;Select value={String(form.cooking_skill ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;cooking_skill&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;beginner&quot;&gt;Beginner&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;intermediate&quot;&gt;Intermediate&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;advanced&quot;&gt;Advanced&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;&#10;              {/* Extended onboarding fields - also show in edit mode */}&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Budget level&lt;/Label&gt;&#10;                &lt;Select value={String(form.budget_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;budget_level&quot;, v)}&gt;&#10;                  &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                    &lt;SelectValue /&gt;&#10;                  &lt;/SelectTrigger&gt;&#10;                  &lt;SelectContent&gt;&#10;                    &lt;SelectItem value=&quot;low&quot;&gt;Low&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;medium&quot;&gt;Medium&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;high&quot;&gt;High&lt;/SelectItem&gt;&#10;                    &lt;SelectItem value=&quot;no_preference&quot;&gt;No preference&lt;/SelectItem&gt;&#10;                  &lt;/SelectContent&gt;&#10;                &lt;/Select&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Protein target (g)&lt;/Label&gt;&#10;                &lt;Input type=&quot;number&quot; value={form.protein_target_g ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;protein_target_g&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Is morning person&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.is_morning_person} onCheckedChange={(v) =&gt; updateField(&quot;is_morning_person&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Usually rushed mornings&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.usually_rushed_mornings} onCheckedChange={(v) =&gt; updateField(&quot;usually_rushed_mornings&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Include snacks&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.snacks_included} onCheckedChange={(v) =&gt; updateField(&quot;snacks_included&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div&gt;&#10;                &lt;Label&gt;Snack often&lt;/Label&gt;&#10;                &lt;label className=&quot;flex items-center space-x-2&quot;&gt;&#10;                  &lt;Checkbox checked={!!form.snacks_often} onCheckedChange={(v) =&gt; updateField(&quot;snacks_often&quot;, !!v)} /&gt;&#10;                  &lt;span className=&quot;text-sm&quot;&gt;Yes&lt;/span&gt;&#10;                &lt;/label&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Favorite cuisines&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {cuisines.map((c) =&gt; (&#10;                    &lt;label key={c.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.favorite_cuisines?.includes(c.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.favorite_cuisines?.includes(c.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.favorite_cuisines ?? [];&#10;                        const updated = current.includes(c.id) ? current.filter((i) =&gt; i !== c.id) : [...current, c.id];&#10;                        updateField(&quot;favorite_cuisines&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{c.name}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Dietary restrictions&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {dietaryOptions.map((d) =&gt; (&#10;                    &lt;label key={d.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.dietary_restrictions?.includes(d.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.dietary_restrictions?.includes(d.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.dietary_restrictions ?? [];&#10;                        const updated = current.includes(d.id) ? current.filter((i) =&gt; i !== d.id) : [...current, d.id];&#10;                        updateField(&quot;dietary_restrictions&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{d.label}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;col-span-full&quot;&gt;&#10;                &lt;CardHeader&gt;&#10;                  &lt;CardTitle className=&quot;text-base&quot;&gt;Kitchen equipment&lt;/CardTitle&gt;&#10;                &lt;/CardHeader&gt;&#10;                &lt;div className=&quot;grid grid-cols-3 gap-2&quot;&gt;&#10;                  {equipmentOptions.map((e) =&gt; (&#10;                    &lt;label key={e.id} className={`flex items-center space-x-2 p-2 rounded-md border cursor-pointer ${form.kitchen_equipment?.includes(e.id) ? &quot;bg-primary/10 border-primary&quot; : &quot;hover:bg-muted&quot;}`}&gt;&#10;                      &lt;Checkbox checked={form.kitchen_equipment?.includes(e.id)} onCheckedChange={() =&gt; {&#10;                        const current = form.kitchen_equipment ?? [];&#10;                        const updated = current.includes(e.id) ? current.filter((i) =&gt; i !== e.id) : [...current, e.id];&#10;                        updateField(&quot;kitchen_equipment&quot;, updated);&#10;                      }} /&gt;&#10;                      &lt;span className=&quot;text-sm&quot;&gt;{e.label}&lt;/span&gt;&#10;                    &lt;/label&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;              &lt;div className=&quot;col-span-full flex gap-2 justify-end&quot;&gt;&#10;                &lt;Button variant=&quot;secondary&quot; onClick={() =&gt; setEditing(false)} type=&quot;button&quot;&gt;Cancel&lt;/Button&gt;&#10;                &lt;Button type=&quot;submit&quot; disabled={loading}&gt;{loading ? &quot;Saving...&quot; : &quot;Save&quot;}&lt;/Button&gt;&#10;              &lt;/div&gt;&#10;              {error &amp;&amp; &lt;p className=&quot;text-sm text-destructive col-span-full&quot;&gt;{error}&lt;/p&gt;}&#10;            &lt;/form&gt;&#10;          )}&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  }&#10;&#10;  return (&#10;    &lt;div&gt;&#10;      &lt;div className=&quot;flex items-center justify-between mb-2&quot;&gt;&#10;        {showHeader &amp;&amp; (&#10;          &lt;div&gt;&#10;            &lt;h3 className=&quot;text-lg font-medium&quot;&gt;Nutrition Profile&lt;/h3&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Your dietary settings&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        )}&#10;&#10;      &lt;/div&gt;&#10;&#10;      {!editing ? (&#10;        &lt;div className=&quot;grid grid-cols-2 md:grid-cols-4 gap-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Age&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.age ?? &quot;—&quot;} years&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Weight&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.weight_kg ?? &quot;—&quot;} kg&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Height&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.height_cm ?? &quot;—&quot;} cm&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Calorie Target&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.calorie_target ?? &quot;—&quot;} kcal&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Activity Level&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{String(initialProfile.activity_level ?? &quot;&quot;).replace(&quot;_&quot;, &quot; &quot;) || &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Goal&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{String(initialProfile.primary_goal ?? &quot;&quot;).replace(&quot;_&quot;, &quot; &quot;) || &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Meals per Day&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium&quot;&gt;{initialProfile.meals_per_day ?? &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;Cooking Skill&lt;/p&gt;&#10;            &lt;p className=&quot;font-medium capitalize&quot;&gt;{initialProfile.cooking_skill ?? &quot;—&quot;}&lt;/p&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      ) : (&#10;        &lt;form onSubmit={save} className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4 mt-4&quot;&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Full name&lt;/Label&gt;&#10;            &lt;Input value={form.full_name ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;full_name&quot;, e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Username&lt;/Label&gt;&#10;            &lt;Input value={form.username ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;username&quot;, e.target.value)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Age&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.age ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;age&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Weight (kg)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.weight_kg ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;weight_kg&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Height (cm)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.height_cm ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;height_cm&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Calorie Target (kcal)&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.calorie_target ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;calorie_target&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Activity Level&lt;/Label&gt;&#10;            &lt;Select value={String(form.activity_level ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;activity_level&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;sedentary&quot;&gt;Sedentary&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;lightly_active&quot;&gt;Lightly active&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;moderately_active&quot;&gt;Moderately active&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;very_active&quot;&gt;Very active&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Goal&lt;/Label&gt;&#10;            &lt;Select value={String(form.primary_goal ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;primary_goal&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;maintain_weight&quot;&gt;Maintain weight&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;lose_weight&quot;&gt;Lose weight&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;gain_weight&quot;&gt;Gain weight&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Meals per day&lt;/Label&gt;&#10;            &lt;Input type=&quot;number&quot; value={form.meals_per_day ?? &quot;&quot;} onChange={(e) =&gt; updateField(&quot;meals_per_day&quot;, e.target.value ? Number(e.target.value) : null)} /&gt;&#10;          &lt;/div&gt;&#10;          &lt;div&gt;&#10;            &lt;Label&gt;Cooking skill&lt;/Label&gt;&#10;            &lt;Select value={String(form.cooking_skill ?? &quot;&quot;)} onValueChange={(v) =&gt; updateField(&quot;cooking_skill&quot;, v)}&gt;&#10;              &lt;SelectTrigger className=&quot;w-full&quot;&gt;&#10;                &lt;SelectValue /&gt;&#10;              &lt;/SelectTrigger&gt;&#10;              &lt;SelectContent&gt;&#10;                &lt;SelectItem value=&quot;beginner&quot;&gt;Beginner&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;intermediate&quot;&gt;Intermediate&lt;/SelectItem&gt;&#10;                &lt;SelectItem value=&quot;advanced&quot;&gt;Advanced&lt;/SelectItem&gt;&#10;              &lt;/SelectContent&gt;&#10;            &lt;/Select&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div className=&quot;col-span-full flex gap-2 justify-end&quot;&gt;&#10;            &lt;Button variant=&quot;secondary&quot; onClick={() =&gt; setEditing(false)} type=&quot;button&quot;&gt;Cancel&lt;/Button&gt;&#10;            &lt;Button type=&quot;submit&quot; disabled={loading}&gt;{loading ? &quot;Saving...&quot; : &quot;Save&quot;}&lt;/Button&gt;&#10;          &lt;/div&gt;&#10;          {error &amp;&amp; &lt;p className=&quot;text-sm text-destructive col-span-full&quot;&gt;{error}&lt;/p&gt;}&#10;        &lt;/form&gt;&#10;      )}&#10;    &lt;/div&gt;&#10;  );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>